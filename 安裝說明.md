# 📱 mesonRadio APK 安裝說明

## ✅ APK 已建置完成

APK 位置：`android\app\build\outputs\apk\release\app-release.apk`

---

## 🚀 安裝方法

### 方法 1: 使用 ADB 安裝（推薦）

**雙擊執行：** `install-apk-with-adb.bat`

腳本會自動：
1. 檢查 ADB 工具
2. 檢查 APK 檔案
3. 檢查手機連接
4. 安裝 APK

### 方法 2: 手動安裝

1. 將 `app-release.apk` 複製到手機
2. 在手機上點擊安裝
3. 允許安裝未知來源應用程式

---

## ⚙️ 安裝前準備

### 1. 啟用 USB 偵錯

**小米手機：**
1. 設定 → 我的裝置 → 全部參數
2. 連續點擊「MIUI 版本」7 次
3. 返回 → 更多設定 → 開發者選項
4. 啟用「USB 偵錯」

**其他 Android 手機：**
1. 設定 → 關於手機
2. 連續點擊「版本號碼」7 次
3. 返回 → 系統 → 開發者選項
4. 啟用「USB 偵錯」

### 2. 連接手機

1. 使用 USB 資料線連接手機到電腦
2. 手機上會彈出「允許 USB 偵錯」提示
3. **勾選「一律允許」** 並點擊「確定」
4. 保持手機螢幕解鎖

---

## 🎯 鎖屏播放測試

### 測試步驟

1. **開啟應用程式** → mesonRadio
2. **選擇電台** → 點擊播放
3. **鎖定螢幕** → 按電源鍵
4. **驗證播放** → 音訊應繼續播放 ⭐
5. **檢查通知** → 通知欄應顯示播放資訊

### 預期效果

- ✅ 鎖屏後音訊繼續播放
- ✅ 通知欄顯示播放資訊
- ✅ 可透過通知控制播放
- ✅ 長時間播放不中斷

---

## 📱 小米手機必須設定

**路徑：** 設定 → 應用程式 → 應用程式管理 → mesonRadio

### 必須設定的權限：

1. ⭐ **省電策略** → 無限制
2. ⭐ **自啟動** → 允許
3. ⭐ **後台彈出介面** → 允許
4. ⭐ **鎖屏顯示** → 允許

**⚠️ 不設定這些權限，系統會終止後台播放！**

---

## 🔧 優化方案說明

### 已實現的優化

本版本使用優化的 **Expo AV** 方案，包含：

1. ✅ **後台播放配置** - `staysActiveInBackground: true`
2. ✅ **Keep Awake** - 保持裝置喚醒
3. ✅ **前台服務** - 防止被系統終止
4. ✅ **自動重連** - 網路中斷自動恢復
5. ✅ **健康檢查** - 每 30 秒檢查播放狀態
6. ✅ **持續通知** - 無法滑動移除的通知

### 為什麼不用 Track Player？

經過測試，`react-native-track-player` 所有版本都與當前專案的 Kotlin 版本不相容，會出現編譯錯誤。因此採用優化的 Expo AV 方案，同樣能實現穩定的鎖屏播放。

---

## ❓ 常見問題

### Q1: 鎖屏後還是停止了？

**檢查清單：**
- ✅ 已授予後台執行權限
- ✅ 已關閉電池最佳化
- ✅ 小米手機已設定上述 4 個權限
- ✅ 沒有使用清理大師等工具

### Q2: 安裝失敗？

**可能原因：**
1. 手機未透過 USB 連接
2. 未啟用 USB 偵錯模式
3. 未授權此電腦
4. 手機螢幕鎖定

**解決方案：**
1. 檢查 USB 資料線
2. 重新啟用 USB 偵錯
3. 在手機上點擊「允許此電腦偵錯」
4. 保持手機螢幕解鎖狀態

### Q3: 找不到 ADB 工具？

**解決方案：**
1. 確認已安裝 Android Studio
2. 或單獨下載 SDK Platform Tools:
   https://developer.android.com/studio/releases/platform-tools
3. 使用方法 2 手動安裝

---

## 📚 相關文件

- 📖 `鎖屏播放優化方案.md` - 技術方案詳細說明
- 📖 `鎖屏播放測試指南.md` - 完整測試步驟
- 📖 `构建说明.txt` - 快速查看狀態

---

## 🎉 開始使用

1. **連接手機** → USB 資料線連接
2. **執行腳本** → 雙擊 `install-apk-with-adb.bat`
3. **設定權限** → 小米手機必須設定
4. **測試播放** → 驗證鎖屏播放功能

祝使用愉快！🎵

